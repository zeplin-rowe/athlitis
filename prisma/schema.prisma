datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Difficulty {
  beginner
  intermediate
  advanced
}

enum Category {
  strength
  cardio
  mobility
  balance
  stretching
  plyometrics
  rehabilitation
  other
}

model User {
  id           Int               @id @default(autoincrement())
  username     String?           @unique
  email        String            @unique
  passwordHash String?
  createdAt    DateTime          @default(now())
  routines     Routine[]
  logs         UserExerciseLog[]
}

model Exercise {
  id               Int         @id @default(autoincrement())
  apiId            String      @unique
  name             String
  bodyPart         String?     @db.VarChar(100)
  equipment        String?
  targetMuscle     String?     @db.VarChar(100)
  gifUrl           String?
  thumbnailUrl     String?
  description      String?
  instructions     String[]    @default([])
  secondaryMuscles String[]    @default([])
  difficulty       Difficulty?
  category         Category?
  images           String[]    @default([]) 
  createdAt        DateTime    @default(now())

  routineExercises RoutineExercise[]
  userLogs         UserExerciseLog[]

  @@index([bodyPart])
  @@index([targetMuscle])
}

model Routine {
  id           Int         @id @default(autoincrement())
  user         User        @relation(fields: [userId], references: [id])
  userId       Int
  name         String      @db.VarChar(100)
  description  String?
  difficulty   Difficulty?
  category     Category?
  thumbnailUrl String?
  createdAt    DateTime    @default(now())

  exercises RoutineExercise[]
}

model RoutineExercise {
  id         Int      @id @default(autoincrement())
  routine    Routine  @relation(fields: [routineId], references: [id])
  routineId  Int
  exercise   Exercise @relation(fields: [exerciseId], references: [id])
  exerciseId Int
  orderIndex Int
  sets       Int?
  reps       Int?
}

model UserExerciseLog {
  id          Int      @id @default(autoincrement())
  user        User     @relation(fields: [userId], references: [id])
  userId      Int
  exercise    Exercise @relation(fields: [exerciseId], references: [id])
  exerciseId  Int
  performedAt DateTime @default(now())
  sets        Int?
  reps        Int?
  weight      Float?
}